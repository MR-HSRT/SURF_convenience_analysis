"0","#| label: b01-device-groups-create"
"0","#| warning: false"
"0","#| message: false"
"0",""
"0","# ------------------------------------------------------------"
"0","# Gerätebesitzgruppen auf Haushaltsebene"
"0","# ------------------------------------------------------------"
"0",""
"0","# Gerätevariablen (Inhalte)"
"0","device_vars <- names(daten_analysis)[stringr::str_detect(names(daten_analysis), ""^dev_"")]"
"0",""
"0","# Long-Format: Haushalt × Gerät"
"0","devices_long_hh <- daten_analysis |>"
"0","  dplyr::select(dplyr::all_of(device_vars)) |>"
"0","  dplyr::mutate(hh_id = dplyr::row_number()) |>"
"0","  tidyr::pivot_longer("
"0","    cols = -hh_id,"
"0","    names_to = ""device"","
"0","    values_to = ""status_raw"""
"0","  ) |>"
"0","  dplyr::mutate("
"0","    status_code = suppressWarnings(as.integer(as.character(status_raw)))"
"0","  )"
"0",""
"0","# Haushaltsweise Flags"
"0","device_group_flags <- devices_long_hh |>"
"0","  dplyr::group_by(hh_id) |>"
"0","  dplyr::summarise("
"0","    has_device        = any(status_code == 1, na.rm = TRUE),"
"0","    plans_shortterm   = any(status_code == 2, na.rm = TRUE),"
"0","    plans_longterm    = any(status_code == 3, na.rm = TRUE),"
"0","    .groups = ""drop"""
"0","  )"
"0",""
"0","# Gruppenvariable (Prioritätslogik!)"
"0","device_groups <- device_group_flags |>"
"0","  dplyr::mutate("
"0","    device_group = dplyr::case_when("
"0","      has_device ~ ""Aktive Flexibilitätsnutzer"","
"0","      !has_device & plans_shortterm ~ ""Kurzfristige Adopter"","
"0","      !has_device & !plans_shortterm & plans_longterm ~ ""Langfristig Interessierte"","
"0","      TRUE ~ ""Nicht-Adopter"""
"0","    ),"
"0","    device_group = factor("
"0","      device_group,"
"0","      levels = c("
"0","        ""Aktive Flexibilitätsnutzer"","
"0","        ""Kurzfristige Adopter"","
"0","        ""Langfristig Interessierte"","
"0","        ""Nicht-Adopter"""
"0","      )"
"0","    )"
"0","  )"
"0",""
"0","# Gruppenvariable an daten_analysis anhängen"
"0","daten_analysis <- daten_analysis |>"
"0","  dplyr::mutate("
"0","    device_group = device_groups$device_group"
"0","  )"
"0",""
