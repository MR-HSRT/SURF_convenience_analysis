"0","#| label: block01-devices-overview"
"0","#| warning: false"
"0","#| message: false"
"0",""
"0","# ============================================================"
"0","# BLOCK 01: Geräteausstattung (Stichprobenbeschreibung)"
"0","# - nutzt deinen SURF Plot Style (theme_surf + brand_plot_surf)"
"0","# - ein Übersichtsplot für alle Geräte"
"0","# - Export: outputs/plots/01_01_devices_overview.png"
"0","# ============================================================"
"0",""
"0","# Save-Plot Engine (einfach, robust)"
"0","save_plot <- function(plot, block, sub, slug,"
"0","                      width = 8, height = 5, dpi = 300) {"
"0","  filename <- sprintf(""%02d_%02d_%s.png"", block, sub, slug)"
"0","  path <- file.path(PLOTS_DIR, filename)"
"0","  ggplot2::ggsave(filename = path, plot = plot, width = width, height = height, dpi = dpi)"
"0","  invisible(path)"
"0","}"
"0",""
"0","# 1) Gerätevariablen: nur dev_-Inhalte (time ist bereits aus daten_analysis raus)"
"0","device_vars <- names(daten_analysis)[stringr::str_detect(names(daten_analysis), ""^dev_"")]"
"0",""
"0","if (length(device_vars) == 0) stop(""Block 01: Keine dev_-Variablen in daten_analysis gefunden."")"
"0",""
"0","# 2) Gerätnamen (falls Spalten anders heißen: hier anpassen)"
"0","device_labels <- c("
"0","  dev_box     = ""Wallbox für Elektroauto"","
"0","  dev_heat    = ""Wärmepumpe"","
"0","  dev_battery = ""Batteriespeicher"","
"0","  dev_pv      = ""Photovoltaik-Anlage (Solaranlage)"","
"0","  dev_hems    = ""Energiemanagementsystem"""
"0",")"
"0",""
"0","# 3) Statuslabels (gemäß Umfrage: 1–4)"
"0","status_levels <- c("
"0","  ""Besitze ich"","
"0","  ""Plane ich in den nächsten 12 Monaten"","
"0","  ""Plane ich langfristig"","
"0","  ""Besitze ich nicht und plane keine Anschaffung"""
"0",")"
"0",""
"0","# 4) Long-Format + Rekodierung"
"0","devices_long <- daten_analysis |>"
"0","  dplyr::select(dplyr::all_of(device_vars)) |>"
"0","  tidyr::pivot_longer("
"0","    cols = dplyr::everything(),"
"0","    names_to = ""device"","
"0","    values_to = ""status_raw"""
"0","  ) |>"
"0","  dplyr::mutate("
"0","    device_label = dplyr::if_else("
"0","      device %in% names(device_labels),"
"0","      unname(device_labels[device]),"
"0","      device"
"0","    ),"
"0","    status_code = suppressWarnings(as.integer(as.character(status_raw))),"
"0","    status = dplyr::case_when("
"0","      status_code == 1 ~ status_levels[1],"
"0","      status_code == 2 ~ status_levels[2],"
"0","      status_code == 3 ~ status_levels[3],"
"0","      status_code == 4 ~ status_levels[4],"
"0","      TRUE ~ ""Keine Angabe"""
"0","    ),"
"0","    status = factor(status, levels = c(status_levels, ""Keine Angabe""))"
"0","  ) |>"
"0","  dplyr::select(device_label, status)"
"0",""
"0","# 5) Tabelle (n / %)"
"0","device_table <- devices_long |>"
"0","  dplyr::count(device_label, status, name = ""Anzahl"") |>"
"0","  dplyr::group_by(device_label) |>"
"0","  dplyr::mutate(Anteil = round(Anzahl / sum(Anzahl) * 100, 1)) |>"
"0","  dplyr::ungroup() |>"
"0","  dplyr::arrange(device_label, match(status, levels(devices_long$status)))"
"0",""
"0","knitr::kable("
"0","  device_table,"
"0","  col.names = c(""Gerät"", ""Status"", ""Anzahl"", ""Anteil (%)""),"
"0","  align = c(""l"", ""l"", ""r"", ""r""),"
"0","  caption = ""Geräteausstattung der Stichprobe: Besitz und geplante Anschaffung steuerbarer Geräte."""
"0",")"
