"0","#| label: surf-label-utils"
"0","#| include: false"
"0",""
"0","# Prozent-Formatierung (einheitlich)"
"0","fmt_pct <- function(x, acc = 1) scales::percent(x, accuracy = acc)"
"0",""
"0","# Label nur anzeigen, wenn Segment groß genug ist (gegen Overplotting)"
"0","pct_if_big <- function(x, min_pct = 0.05, acc = 0) {"
"0","  dplyr::if_else(x >= min_pct, fmt_pct(x, acc), """")"
"0","}"
"0",""
"0","# Labels für horizontale Balken (Prozent rechts außen)"
"0","add_bar_labels_h <- function(size = 3.2, acc = 1, colour = SURF_TEXT) {"
"0","  ggplot2::geom_text("
"0","    ggplot2::aes(label = fmt_pct(..x.., acc)),"
"0","    stat = ""identity"","
"0","    hjust = -0.05,"
"0","    size = size,"
"0","    colour = colour"
"0","  )"
"0","}"
"0",""
"0","# Labels für vertikale Balken (Prozent über Balken)"
"0","add_bar_labels_v <- function(size = 3.2, acc = 1, colour = SURF_TEXT, vjust = -0.4) {"
"0","  ggplot2::geom_text("
"0","    ggplot2::aes(label = fmt_pct(y, acc)),"
"0","    vjust = vjust,"
"0","    size = size,"
"0","    colour = colour"
"0","  )"
"0","}"
"0",""
"0","# Labels in 100%-Stacked Segmenten (nur wenn Segment >= min_pct)"
"0","add_stack_labels <- function(size = 3.0, acc = 0, min_pct = 0.06, colour = ""white"") {"
"0","  ggplot2::geom_text("
"0","    ggplot2::aes(label = pct_if_big(Anteil_prop, min_pct = min_pct, acc = acc)),"
"0","    position = ggplot2::position_stack(vjust = 0.5),"
"0","    size = size,"
"0","    colour = colour"
"0","  )"
"0","}"
"0",""
"0","# Labels für Punktplots (Mean über Punkt)"
"0","add_point_labels <- function(size = 3.1, digits = 2, colour = SURF_TEXT, vjust = -1) {"
"0","  ggplot2::geom_text("
"0","    ggplot2::aes(label = round(mean, digits)),"
"0","    vjust = vjust,"
"0","    size = size,"
"0","    colour = colour"
"0","  )"
"0","}"
"0",""
"0","# Labels für Prozentpunkte in Differenzplots (außerhalb, links/rechts je Vorzeichen)"
"0","add_diff_labels_h <- function(xvar = ""diff"", size = 3.2, acc = 1, colour = SURF_TEXT) {"
"0","  ggplot2::geom_text("
"0","    ggplot2::aes(label = fmt_pct(.data[[xvar]], acc)),"
"0","    hjust = ifelse(control_diff[[xvar]] >= 0, -0.05, 1.05),"
"0","    size = size,"
"0","    colour = colour"
"0","  )"
"0","}"
"0",""
