"0",""
"0","#| label: b04-control-among-owners"
"0","#| warning: false"
"0","#| message: false"
"0",""
"0","# ------------------------------------------------------------"
"0","# Steuerungsbereitschaft je Gerät – nur unter Gerätebesitzern"
"0","# Definition: Anteil ""Ja"" in control_* innerhalb owner_group == ""Gerätebesitzer"""
"0","# Output:"
"0","#  - Tabelle (Prozent)"
"0","#  - Plot (Prozent), Export: outputs/plots/04_03_control_among_owners.png"
"0","# ------------------------------------------------------------"
"0",""
"0","# Falls control_long noch nicht existiert (robust)"
"0","if (!exists(""control_long"")) {"
"0",""
"0","  control_vars <- names(daten_analysis)[stringr::str_detect(names(daten_analysis), ""^control_"")]"
"0",""
"0","  control_labels <- c("
"0","    control_wallbox = ""Wallbox"","
"0","    control_heatpump = ""Wärmepumpe"","
"0","    control_battery = ""Batteriespeicher"","
"0","    control_pv = ""Photovoltaikanlage"","
"0","    control_ems = ""Energiemanagementsystem"""
"0","  )"
"0",""
"0","  control_long <- daten_analysis |>"
"0","    dplyr::select(dplyr::all_of(control_vars), owner_group, rand_freq) |>"
"0","    tidyr::pivot_longer("
"0","      cols = dplyr::all_of(control_vars),"
"0","      names_to = ""device"","
"0","      values_to = ""control_raw"""
"0","    ) |>"
"0","    dplyr::mutate("
"0","      device_label = dplyr::recode(device, !!!control_labels),"
"0","      control_yes = suppressWarnings(as.integer(as.character(control_raw))) == 1"
"0","    )"
"0","}"
"0",""
"0","# 1) Nur Gerätebesitzer"
"0","control_owners <- control_long |>"
"0","  dplyr::filter(owner_group == ""Gerätebesitzer"")"
"0",""
"0","# 2) Zustimmung je Gerät (Prozent)"
"0","control_owners_summary <- control_owners |>"
"0","  dplyr::group_by(device_label) |>"
"0","  dplyr::summarise("
"0","    Zustimmung = mean(control_yes, na.rm = TRUE),"
"0","    n = sum(!is.na(control_yes)),"
"0","    .groups = ""drop"""
"0","  ) |>"
"0","  dplyr::mutate("
"0","    Zustimmung_pct = round(Zustimmung * 100, 1)"
"0","  ) |>"
"0","  dplyr::arrange(dplyr::desc(Zustimmung))"
"0",""
"0","# Tabelle"
"0","knitr::kable("
"0","  control_owners_summary |>"
"0","    dplyr::select(device_label, n, Zustimmung_pct),"
"0","  col.names = c(""Gerät"", ""n (gültig)"", ""Zustimmung (%)""),"
"0","  align = c(""l"", ""r"", ""r""),"
"0","  caption = ""Grundsätzliche Bereitschaft zur automatischen Steuerung (nur unter Gerätebesitzern)."""
"0",")"
