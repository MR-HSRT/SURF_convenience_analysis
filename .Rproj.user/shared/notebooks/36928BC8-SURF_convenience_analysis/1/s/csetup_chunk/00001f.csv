"0","#| label: setup"
"0","#| include: false"
"0",""
"0","# ----------------------------"
"0","# 1) Pakete installieren, pr端fen und laden"
"0","# ----------------------------"
"0",""
"0","# Stabiler CRAN-Mirror (wichtig, falls RStudio alte Repos nutzt)"
"0","options(repos = c(CRAN = ""https://cloud.r-project.org""))"
"0",""
"0","required_pkgs <- c("
"0","  ""here"",""readr"",""dplyr"",""tidyr"",""stringr"",""janitor"",""labelled"","
"0","  ""psych"",""gtsummary"",""flextable"",""ggplot2"",""scales"",""broom"",""knitr"","
"0","  ""readxl"""
"0",")"
"0",""
"0","# Fehlende Pakete ermitteln"
"0","missing_pkgs <- required_pkgs[!vapply(required_pkgs, requireNamespace, logical(1), quietly = TRUE)]"
"0",""
"0","# Fehlende Pakete installieren (ohne Stop; mit klarer Meldung)"
"0","if (length(missing_pkgs) > 0) {"
"0","  message(""Installiere fehlende Pakete: "", paste(missing_pkgs, collapse = "", ""))"
"0","  tryCatch("
"0","    {"
"0","      install.packages(missing_pkgs, dependencies = TRUE)"
"0","    },"
"0","    error = function(e) {"
"0","      message(""Paketinstallation fehlgeschlagen: "", conditionMessage(e))"
"0","      message(""Hinweis: Bitte R/RStudio neu starten und erneut ausf端hren. "","
"0","              ""Falls weiterhin Probleme: R als Admin starten oder Schreibrechte f端r die Library pr端fen."")"
"0","    }"
"0","  )"
"0","}"
"0",""
"0","# Pakete laden (leise; ohne Fehlermeldungsflut)"
"0","loaded <- vapply(required_pkgs, function(pkg) {"
"0","  suppressWarnings(suppressPackageStartupMessages(require(pkg, character.only = TRUE)))"
"0","}, logical(1))"
"0",""
"0","# Wenn etwas trotz Install-Versuch nicht ladbar ist: nur eine kompakte Warnung"
"0","if (any(!loaded)) {"
"0","  warning(""Folgende Pakete konnten nicht geladen werden: "","
"0","          paste(required_pkgs[!loaded], collapse = "", ""),"
"0","          call. = FALSE)"
"0","}"
"0",""
"0","# ----------------------------"
"0","# 2) Ordnerstruktur erstellen"
"0","# ----------------------------"
"0","dir.create(here::here(""data"", ""raw""),        recursive = TRUE, showWarnings = FALSE)"
"0","dir.create(here::here(""data"", ""processed""),  recursive = TRUE, showWarnings = FALSE)"
"0","dir.create(here::here(""outputs"", ""plots""),   recursive = TRUE, showWarnings = FALSE)"
"0","dir.create(here::here(""outputs"", ""tables""),  recursive = TRUE, showWarnings = FALSE)"
"0",""
"0","# ----------------------------"
"0","# 3) Reproduzierbarkeit"
"0","# ----------------------------"
"0","set.seed(1234)"
"0",""
"0","PLOTS_DIR  <- here::here(""outputs"", ""plots"")"
"0","TABLES_DIR <- here::here(""outputs"", ""tables"")"
"0",""
"0","# ----------------------------"
"0","# 4) .gitignore sicherstellen"
"0","# ----------------------------"
"0","gitignore_path <- here::here("".gitignore"")"
"0",""
"0","gitignore_content <- c("
"0","  ""# --- R / RStudio ---"","
"0","  "".Rproj.user/"","
"0","  "".Rhistory"","
"0","  "".RData"","
"0","  "".Ruserdata"","
"0","  """","
"0","  ""# --- Data files ---"","
"0","  ""*.csv"","
"0","  ""*.xlsx"","
"0","  ""*.json"","
"0","  """","
"0","  ""# --- Quarto ---"","
"0","  ""*_cache/"","
"0","  ""*_files/"","
"0","  """","
"0","  ""# --- Private data (NEVER commit) ---"","
"0","  ""data/raw/"","
"0","  ""data/processed/"","
"0","  """","
"0","  ""# --- Local secrets ---"","
"0","  "".env"""
"0",")"
"0",""
"0","if (!file.exists(gitignore_path)) {"
"0","  writeLines(gitignore_content, gitignore_path)"
"0","} else {"
"0","  existing_raw  <- readLines(gitignore_path, warn = FALSE)"
"0","  existing_trim <- trimws(existing_raw)"
"0",""
"0","  to_add <- gitignore_content[!gitignore_content %in% existing_trim]"
"0",""
"0","  if (length(to_add) > 0) {"
"0","    writeLines(c(existing_raw, to_add), gitignore_path)"
"0","  }"
"0","}"
"0",""
